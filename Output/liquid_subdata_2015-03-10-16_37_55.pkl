(dp0
S'rt'
p1
(dp2
sS'stim_log'
p3
(dp4
sS'trialdata'
p5
(dp6
I0
(dp7
S'onset'
p8
cnumpy.core.multiarray
scalar
p9
(cnumpy
dtype
p10
(S'f8'
p11
I0
I1
tp12
Rp13
(I3
S'<'
p14
NNNI-1
I-1
I0
tp15
bS'\x00\x00\x00\x00\x00\x00\x00\x00'
p16
tp17
Rp18
ssI1
(dp19
g8
g9
(g13
S'\x00\x00\x00\x00\x00\x00$@'
p20
tp21
Rp22
ssI2
(dp23
g8
g9
(g13
S'\x00\x00\x00\x00\x00\x004@'
p24
tp25
Rp26
ssI3
(dp27
g8
g9
(g13
S'\x00\x00\x00\x00\x00\x00>@'
p28
tp29
Rp30
ssI4
(dp31
g8
g9
(g13
S'\x00\x00\x00\x00\x00\x00D@'
p32
tp33
Rp34
ssI5
(dp35
g8
g9
(g13
S'\x00\x00\x00\x00\x00\x00I@'
p36
tp37
Rp38
ssI6
(dp39
g8
g9
(g13
S'\x00\x00\x00\x00\x00\x00N@'
p40
tp41
Rp42
ssI7
(dp43
g8
g9
(g13
S'\x00\x00\x00\x00\x00\x80Q@'
p44
tp45
Rp46
ssI8
(dp47
g8
g9
(g13
S'\x00\x00\x00\x00\x00\x00T@'
p48
tp49
Rp50
ssI9
(dp51
g8
g9
(g13
S'\x00\x00\x00\x00\x00\x80V@'
p52
tp53
Rp54
ssI10
(dp55
g8
g9
(g13
S'\x00\x00\x00\x00\x00\x00Y@'
p56
tp57
Rp58
ssI11
(dp59
g8
g9
(g13
S'\x00\x00\x00\x00\x00\x80[@'
p60
tp61
Rp62
ssI12
(dp63
g8
g9
(g13
S'\x00\x00\x00\x00\x00\x00^@'
p64
tp65
Rp66
ssI13
(dp67
g8
g9
(g13
S'\x00\x00\x00\x00\x00@`@'
p68
tp69
Rp70
ssI14
(dp71
g8
g9
(g13
S'\x00\x00\x00\x00\x00\x80a@'
p72
tp73
Rp74
ssI15
(dp75
g8
g9
(g13
S'\x00\x00\x00\x00\x00\xc0b@'
p76
tp77
Rp78
ssI16
(dp79
g8
g9
(g13
S'\x00\x00\x00\x00\x00\x00d@'
p80
tp81
Rp82
ssI17
(dp83
g8
g9
(g13
S'\x00\x00\x00\x00\x00@e@'
p84
tp85
Rp86
ssI18
(dp87
g8
g9
(g13
S'\x00\x00\x00\x00\x00\x80f@'
p88
tp89
Rp90
ssI19
(dp91
g8
g9
(g13
S'\x00\x00\x00\x00\x00\xc0g@'
p92
tp93
Rp94
ssI20
(dp95
g8
g9
(g13
S'\x00\x00\x00\x00\x00\x00i@'
p96
tp97
Rp98
ssI21
(dp99
g8
g9
(g13
S'\x00\x00\x00\x00\x00@j@'
p100
tp101
Rp102
ssI22
(dp103
g8
g9
(g13
S'\x00\x00\x00\x00\x00\x80k@'
p104
tp105
Rp106
ssI23
(dp107
g8
g9
(g13
S'\x00\x00\x00\x00\x00\xc0l@'
p108
tp109
Rp110
sssS'simulated_response'
p111
I00
sS'script'
p112
(lp113
S'"""\n'
p114
aS'deliver juice\n'
p115
aS'"""\n'
p116
aS"sys.path.append('/Users/imagining/Desktop/liquid_working')\n"
p117
aS'\n'
p118
aS'import numpy as N\n'
p119
aS'import syringe_pump\n'
p120
aS'from psychopy import visual, core, event, logging, data, misc, sound\n'
p121
aS'import sys,os,pickle\n'
p122
aS'import socket\n'
p123
aS'from socket import gethostname\n'
p124
aS'import inspect\n'
p125
aS"#sys.path.append('/Applications/liquid/psychtask/')\n"
p126
ag118
aS'import exptutils\n'
p127
aS'from exptutils import *\n'
p128
ag118
aS'import datetime\n'
p129
aS'    \n'
p130
aS'def store_scriptfile():\n'
p131
aS'    scriptfile= inspect.getfile(inspect.currentframe())# save a copy of the script in the data file\n'
p132
aS'    f=open(scriptfile)\n'
p133
aS'    script=f.readlines()\n'
p134
aS'    f.close()\n'
p135
aS'    return script\n'
p136
ag118
aS'def check_for_quit(subdata,win):\n'
p137
aS'    k=event.getKeys()\n'
p138
aS"    print 'checking for quit key %s'%subdata['quit_key']\n"
p139
aS"    print 'found:',k\n"
p140
aS"    if k.count(subdata['quit_key']) >0:# if subdata['quit_key'] is pressed...\n"
p141
aS"        print 'quit key pressed'\n"
p142
aS'        return True\n'
p143
aS'    else:\n'
p144
aS'        return False\n'
p145
ag118
aS'def wait_for_trigger():\n'
p146
aS'    event.clearEvents()\n'
p147
aS"    if subdata['simulated_response']:\n"
p148
aS'        msg="SIMULATION MODE"\n'
p149
aS'    else:\n'
p150
aS"        msg=''\n"
p151
aS"    message=visual.TextStim(win, text='%s Waiting for start key (or press %s)\\nBe very still!'%(msg,subdata['start_key']),\n"
p152
aS"    font='BiauKai', height=1,color=u'white', colorSpace=u'rgb', opacity=1,depth=0.0,\n"
p153
aS"    alignHoriz='center',wrapWidth=50)\n"
p154
aS'    message.setAutoDraw(True) #automatically draw every frame\n'
p155
aS'    win.flip()\n'
p156
aS'    start=False\n'
p157
aS'    while start==False:\n'
p158
aS'        k=event.waitKeys()\n'
p159
aS"        if k.count(subdata['start_key'])>0:#as soon as subdata['start_key'] is pressed...\n"
p160
aS'            start=True\n'
p161
aS"            message.setText('')#this clears the screen\n"
p162
aS'            win.flip()\n'
p163
aS"        if k.count(subdata['quit_key']) >0:# if subdata['quit_key'] is pressed...\n"
p164
aS'            exptutils.shut_down_cleanly(subdata,win)\n'
p165
aS'            return False\n'
p166
aS'    return True\n'
p167
ag118
aS'subdata={}\n'
p168
aS"subdata['subcode']=raw_input('subject id: ')\n"
p169
aS'# initialize subdata dictionary to store info about the study\n'
p170
aS"subdata['completed']=0\n"
p171
aS"subdata['cwd']=os.getcwd()\n"
p172
aS"subdata['hostname']=socket.gethostname()\n"
p173
aS'clock=core.Clock()\n'
p174
aS'datestamp=datetime.datetime.now().strftime("%Y-%m-%d-%H_%M_%S")\n'
p175
aS"subdata['datestamp']=datestamp\n"
p176
aS"subdata['expt_title']='tampico_probabilistic'\n"
p177
aS"subdata['script']=store_scriptfile()\n"
p178
aS"subdata['response']={}\n"
p179
aS"subdata['score']={}\n"
p180
aS"subdata['rt']={}\n"
p181
aS"subdata['stim_onset_time']={}\n"
p182
aS"subdata['stim_log']={}\n"
p183
aS"subdata['is_this_SS_trial']={}\n"
p184
aS"subdata['SS']={}\n"
p185
aS"subdata['broke_on_trial']={}\n"
p186
ag118
aS"subdata['start_key']='5'\n"
p187
aS"subdata['quit_key']='q'\n"
p188
ag118
aS"subdata['simulated_response']=False\n"
p189
ag118
aS"dataFileName='Output/%s_%s_subdata.log'%(subdata['subcode'],subdata['datestamp'])\n"
p190
aS'logging.console.setLevel(logging.INFO)\n'
p191
aS'logfile=logging.LogFile(dataFileName,level=logging.INFO)\n'
p192
ag118
ag118
aS'try:\n'
p193
aS"    print 'initializing serial device:'\n"
p194
aS"    dev=syringe_pump.SyringePump('/dev/tty.usbserial')\n"
p195
aS'    print dev\n'
p196
aS"    print 'using serial device: ', dev\n"
p197
aS'    if not dev.isOpen():\n'
p198
aS"        raise Exception('noPump')\n"
p199
aS'    hasPump=True\n'
p200
aS'except:\n'
p201
aS'    hasPump=False\n'
p202
ag118
ag118
aS'#from new_era import PumpInterface\n'
p203
aS"#pi = PumpInterface(port='/dev/tty.usbserial')\n"
p204
ag118
aS'# deliver 0.5 ml over 5 seconds\n'
p205
aS'# equates to\n'
p206
ag118
aS'diameter=26.59\n'
p207
aS'mls_to_deliver=0.5\n'
p208
aS'delivery_time=2.0\n'
p209
aS'cue_time=2.0\n'
p210
aS'wait_time=2.0\n'
p211
aS'rinse_time=2.0\n'
p212
aS'swallow_time=2.0\n'
p213
aS'trial_length=cue_time+delivery_time+wait_time+rinse_time+swallow_time\n'
p214
ag118
aS'rate = mls_to_deliver*(3600.0/delivery_time)  # mls/hour\n'
p215
ag118
aS"trialcond=N.zeros(24).astype('int')\n"
p216
ag118
aS'trialcond[0:8]=0     # water cue, water delivery\n'
p217
aS'trialcond[8:12]=1    # water cue, juice delivery\n'
p218
aS'trialcond[12:20]=2   # juice cue, juice delivery\n'
p219
aS'trialcond[20:24]=3   # juice cue, water delivery\n'
p220
aS"stim_images=['bottled_water.jpg','bottled_water.jpg','tampico.jpg','tampico.jpg']\n"
p221
aS'ntrials=len(trialcond)\n'
p222
aS'pump=N.zeros(ntrials)\n'
p223
ag118
aS'N.random.shuffle(trialcond)\n'
p224
ag118
aS'# pump zero is neutral, pump 1 is juice\n'
p225
ag118
aS'pump[trialcond==1]=1\n'
p226
aS'pump[trialcond==2]=1\n'
p227
ag118
ag118
ag118
aS'onsets=N.arange(0,ntrials*trial_length,step=trial_length)\n'
p228
ag118
ag118
aS'# clear infusion measurements\n'
p229
aS'if hasPump:\n'
p230
aS"    commands_to_send=['0PHN01','1PHN01','0CLDINF','1CLDINF','0DIRINF','1DIRINF','0RAT%0.1fMH'%rate,'1RAT%0.1fMH'%rate,'0VOL%0.1f'%mls_to_deliver,'1VOL%0.1f'%mls_to_deliver,'0DIA%0.1fMH'%diameter,'1DIA%0.1fMH'%diameter]\n"
p231
aS"    subdata['pumpver']=dev.sendCmd('VER')\n"
p232
ag118
aS'    dev.setBaudrate(9600)\n'
p233
ag118
aS'    for cmd in commands_to_send:\n'
p234
aS"        print 'sending: ',cmd\n"
p235
aS'        dev.sendCmd(cmd)\n'
p236
aS'        core.wait(0.1)\n'
p237
ag118
aS"    subdata['pumpdata']={}\n"
p238
aS'    for p in [0,1]:\n'
p239
aS"        for cmd in ['DIS','DIR','RAT','VOL','DIA']:\n"
p240
aS"            fullcmd='%d%s'%(p,cmd)\n"
p241
aS"            subdata['pumpdata'][fullcmd]=dev.sendCmd(fullcmd)\n"
p242
aS'            core.wait(0.1)\n'
p243
ag118
aS"    print subdata['pumpdata']\n"
p244
ag118
aS'# setup screen\n'
p245
ag118
aS'fullscr=False\n'
p246
ag118
aS"win = visual.Window([800,600],allowGUI=True, fullscr=fullscr, monitor='testMonitor', units='deg')\n"
p247
aS"visual_stim=visual.ImageStim(win, image=N.zeros((300,300)), size=(0.75,0.75),units='height')\n"
p248
ag118
aS'event.clearEvents()\n'
p249
aS'wt=wait_for_trigger()\n'
p250
aS'if not wt:\n'
p251
aS"    print 'quit button pressed!'\n"
p252
aS'    sys.exit()\n'
p253
aS'else:\n'
p254
aS'    print "quit status:",wt\n'
p255
aS'    \n'
p256
aS"message=visual.TextStim(win, text='')\n"
p257
ag118
aS"subdata['trialdata']={}\n"
p258
aS'clock.reset()\n'
p259
aS'event.clearEvents()\n'
p260
ag118
aS'for trial in range(ntrials):\n'
p261
aS'    if check_for_quit(subdata,win):\n'
p262
aS'        exptutils.shut_down_cleanly(subdata,win)\n'
p263
aS'        sys.exit()\n'
p264
ag118
aS'    trialdata={}\n'
p265
aS"    print 'trial %d'%trial\n"
p266
aS"    trialdata['onset']=onsets[trial]\n"
p267
aS"    print 'condition %d'%trialcond[trial]\n"
p268
aS"    logging.log(logging.DATA,'Condition: %d'%trialcond[trial])\n"
p269
aS"    print 'showing image: %s'%stim_images[trialcond[trial]]\n"
p270
aS'    visual_stim.setImage(stim_images[trialcond[trial]])\n'
p271
aS'    visual_stim.draw()\n'
p272
aS"    while clock.getTime()<trialdata['onset']:#wait until the specified onset time to display image_file\n"
p273
aS'        if check_for_quit(subdata,win):\n'
p274
aS'            exptutils.shut_down_cleanly(subdata,win)\n'
p275
aS'            sys.exit()\n'
p276
aS'    win.flip()\n'
p277
ag118
aS"    while clock.getTime()<(trialdata['onset']+cue_time):#show the image\n"
p278
aS'        pass\n'
p279
ag118
aS'    if hasPump:\n'
p280
aS"        print 'injecting via pump at address %d'%pump[trial]\n"
p281
aS"        logging.log(logging.DATA,'injecting via pump at address %d'%pump[trial])\n"
p282
ag118
aS"        dev.sendCmd('%dRUN'%pump[trial])\n"
p283
aS'    else:\n'
p284
aS"        print 'no pump: should be injecting via pump at address %d'%pump[trial]\n"
p285
ag118
aS"    while clock.getTime()<(trialdata['onset']+cue_time+delivery_time):#wait until liquid is delivered\n"
p286
aS'        pass\n'
p287
aS"    message=visual.TextStim(win, text='')\n"
p288
aS'    message.draw()\n'
p289
aS'    win.flip()\n'
p290
aS'    if hasPump:\n'
p291
aS"        trialdata['dis']=[dev.sendCmd('0DIS'),dev.sendCmd('1DIS')]\n"
p292
ag118
ag118
aS"    while clock.getTime()<(trialdata['onset']+cue_time+delivery_time+wait_time):\n"
p293
aS'        pass\n'
p294
ag118
aS'    if hasPump:\n'
p295
aS"        print 'injecting rinse via pump at address %d'%0\n"
p296
aS"        dev.sendCmd('%dRUN'%0)\n"
p297
aS'    else:\n'
p298
aS"        print 'no pump: should be injecting rinse via pump at address %d'%pump[trial]\n"
p299
ag118
aS"    while clock.getTime()<(trialdata['onset']+cue_time+delivery_time+wait_time+rinse_time):\n"
p300
aS'        pass\n'
p301
ag118
aS"    message=visual.TextStim(win, text='swallow')\n"
p302
aS'    message.draw()\n'
p303
aS'    win.flip()\n'
p304
ag118
aS"    while clock.getTime()<(trialdata['onset']+cue_time+delivery_time+wait_time+rinse_time+swallow_time):\n"
p305
aS'        pass\n'
p306
aS"    message=visual.TextStim(win, text='')\n"
p307
aS'    message.draw()\n'
p308
aS'    win.flip()\n'
p309
ag118
aS"    while clock.getTime()<(trialdata['onset']+trial_length):\n"
p310
aS'        pass\n'
p311
ag118
aS"    subdata['trialdata'][trial]=trialdata           \n"
p312
ag118
aS'win.close()\n'
p313
ag118
aS"#print dev.sendCmd('VER')\n"
p314
aS"f=open('Output/liquid_subdata_%s.pkl'%datestamp,'wb')\n"
p315
aS'pickle.dump(subdata,f)\n'
p316
aS'f.close()\n'
p317
asS'SS'
p318
(dp319
sS'completed'
p320
I0
sS'hostname'
p321
S'wireless-10-145-170-88.public.utexas.edu'
p322
sS'quit_key'
p323
S'q'
p324
sS'stim_onset_time'
p325
(dp326
sS'response'
p327
(dp328
sS'is_this_SS_trial'
p329
(dp330
sS'subcode'
p331
S'test'
p332
sS'score'
p333
(dp334
sS'broke_on_trial'
p335
(dp336
sS'datestamp'
p337
S'2015-03-10-16_37_55'
p338
sS'start_key'
p339
S'5'
p340
sS'cwd'
p341
S'/Users/imagining/Desktop/liquid_working'
p342
sS'expt_title'
p343
S'tampico_probabilistic'
p344
s.